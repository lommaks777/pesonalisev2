<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–µ—Å—Ç –≤—Å–µ—Ö —É—Ä–æ–∫–æ–≤ - –ú–∞—Å—Å–∞–∂ –®–í–ó</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    h1 { color: #333; margin: 0 0 10px 0; }
    .lessons-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
      gap: 20px;
    }
    .lesson-card {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .lesson-title {
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 10px;
      color: #333;
    }
    .lesson-status {
      font-size: 14px;
      margin: 5px 0;
    }
    .loading { color: #666; }
    .success { color: #2e7d32; }
    .error { color: #c62828; }
    .warning { color: #f57c00; }
    .lesson-content {
      margin-top: 10px;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 4px;
      font-size: 13px;
      max-height: 200px;
      overflow-y: auto;
    }
    .keyword-check {
      margin-top: 10px;
      padding: 8px;
      border-radius: 4px;
      font-size: 12px;
    }
    .keyword-found {
      background: #ffebee;
      color: #c62828;
      border: 1px solid #ef9a9a;
    }
    .keyword-ok {
      background: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #a5d6a7;
    }
    .summary {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
    }
    .summary-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-top: 15px;
    }
    .stat-card {
      padding: 15px;
      border-radius: 6px;
      text-align: center;
    }
    .stat-card h3 { margin: 0 0 5px 0; font-size: 32px; }
    .stat-card p { margin: 0; font-size: 14px; }
    .stat-total { background: #e3f2fd; color: #1976d2; }
    .stat-success { background: #e8f5e9; color: #2e7d32; }
    .stat-error { background: #ffebee; color: #c62828; }
    .stat-warning { background: #fff3e0; color: #f57c00; }
  </style>
</head>
<body>
  <div class="header">
    <h1>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —É—Ä–æ–∫–æ–≤ –∫—É—Ä—Å–∞ "–ú–∞—Å—Å–∞–∂ –®–í–ó"</h1>
    <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–Ω—ã—Ö —Ç–µ–º</p>
  </div>

  <div id="summary" class="summary" style="display:none;">
    <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
    <div class="summary-stats">
      <div class="stat-card stat-total">
        <h3 id="stat-total">0</h3>
        <p>–í—Å–µ–≥–æ —É—Ä–æ–∫–æ–≤</p>
      </div>
      <div class="stat-card stat-success">
        <h3 id="stat-success">0</h3>
        <p>–£—Å–ø–µ—à–Ω–æ</p>
      </div>
      <div class="stat-card stat-warning">
        <h3 id="stat-warning">0</h3>
        <p>–° –∑–∞–º–µ—á–∞–Ω–∏—è–º–∏</p>
      </div>
      <div class="stat-card stat-error">
        <h3 id="stat-error">0</h3>
        <p>–û—à–∏–±–∫–∏</p>
      </div>
    </div>
  </div>

  <div class="lessons-grid" id="lessons-container"></div>

  <script>
    const API = "https://pesonalisev2-zxby.vercel.app/api/persona";
    const userId = "guest";
    
    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–∫–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    const lessons = [
      { num: 1, title: "–£—Ä–æ–∫ –≤–≤–µ–¥–µ–Ω–∏–µ", keywords: ['–≤–≤–µ–¥–µ–Ω–∏–µ', '–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤', '–∫—É—Ä—Å'], avoid: ['—Ç–µ–π–ø', '—Ç—Ä–∏–≥–≥–µ—Ä'] },
      { num: 2, title: "–ú—ã—à—Ü—ã –®–í–ó", keywords: ['–º—ã—à—Ü', '–∞–Ω–∞—Ç–æ–º', '—Ç—Ä–∞–ø–µ—Ü–∏'], avoid: ['—Ç–µ–π–ø', '–ø–æ—Å—Ç–∏–∑–æ–º–µ—Ç—Ä'] },
      { num: 3, title: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞–Ω–∏–µ", keywords: ['–¥–∏–∞–≥–Ω–æ—Å—Ç', '—Ñ–æ—Ç–æ', '–∫–ª–∏–µ–Ω—Ç'], avoid: ['—Ç–µ–π–ø'] },
      { num: 4, title: "–¢—Ä–∏–≥–≥–µ—Ä–Ω—ã–µ —Ç–æ—á–∫–∏", keywords: ['—Ç—Ä–∏–≥–≥–µ—Ä', '—Ç–æ—á–∫'], avoid: ['—Ç–µ–π–ø', '–º—ã—à—Ü —à–≤'] },
      { num: 5, title: "–£—Ä–æ–∫ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è", keywords: ['–¥–µ–º–æ–Ω—Å—Ç—Ä', '–º–∞—Å—Å–∞–∂'], avoid: ['—Ç–µ–π–ø'] },
      { num: 6, title: "–ü–æ–≤—Ç–æ—Ä—è–π—Ç–µ –∑–∞ –º–Ω–æ–π", keywords: ['–ø–æ–≤—Ç–æ—Ä', '–ø—Ä–∞–∫—Ç–∏–∫'], avoid: ['—Ç–µ–π–ø'] },
      { num: 7, title: "2 —É—Ä–æ–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è", keywords: ['–¥–µ–º–æ–Ω—Å—Ç—Ä'], avoid: ['—Ç–µ–π–ø'] },
      { num: 8, title: "2 –£—Ä–æ–∫ –ø–æ–≤—Ç–æ—Ä—è–π—Ç–µ –∑–∞ –º–Ω–æ–π", keywords: ['–ø–æ–≤—Ç–æ—Ä'], avoid: ['—Ç–µ–π–ø'] },
      { num: 9, title: "3 —É—Ä–æ–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è", keywords: ['–¥–µ–º–æ–Ω—Å—Ç—Ä'], avoid: ['—Ç–µ–π–ø'] },
      { num: 10, title: "3 –£—Ä–æ–∫ –ø–æ–≤—Ç–æ—Ä—è–π—Ç–µ –∑–∞ –º–Ω–æ–π", keywords: ['–ø–æ–≤—Ç–æ—Ä'], avoid: ['—Ç–µ–π–ø'] },
      { num: 11, title: "–ü–æ—Å—Ç–∏–∑–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è —Ä–µ–ª–∞–∫—Å–∞—Ü–∏—è", keywords: ['–ø–æ—Å—Ç–∏–∑–æ–º–µ—Ç—Ä', '—Ä–µ–ª–∞–∫—Å'], avoid: ['—Ç–µ–π–ø', '–º—ã—à—Ü —à–≤'] },
      { num: 12, title: "4 —É—Ä–æ–∫-–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è", keywords: ['–¥–µ–º–æ–Ω—Å—Ç—Ä'], avoid: ['—Ç–µ–π–ø'] }
    ];

    const container = document.getElementById('lessons-container');
    const results = {
      total: lessons.length,
      success: 0,
      warning: 0,
      error: 0
    };

    async function testLesson(lesson) {
      const card = document.createElement('div');
      card.className = 'lesson-card';
      card.innerHTML = `
        <div class="lesson-title">üìñ –£—Ä–æ–∫ ${lesson.num}: ${lesson.title}</div>
        <div class="lesson-status loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="lesson-content" style="display:none;"></div>
        <div class="keyword-check" style="display:none;"></div>
      `;
      container.appendChild(card);

      const statusEl = card.querySelector('.lesson-status');
      const contentEl = card.querySelector('.lesson-content');
      const keywordEl = card.querySelector('.keyword-check');

      try {
        const response = await fetch(`${API}/block`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ 
            user_id: userId, 
            lesson: String(lesson.num),
            title: lesson.title,
            course: "massazh-shvz", 
            flush: false 
          })
        });
        
        const data = await response.json();
        
        if (!data.ok || !data.html) {
          statusEl.className = 'lesson-status error';
          statusEl.textContent = `‚ùå –û—à–∏–±–∫–∞: ${data.error || '–ù–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞'}`;
          results.error++;
          return;
        }

        // –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ HTML
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = data.html;
        const text = tempDiv.innerText.toLowerCase();
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–≤—å—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        const intro = tempDiv.querySelector('h3') ? 
          tempDiv.querySelector('h3').nextElementSibling?.textContent || '–ù–µ—Ç –≤–≤–µ–¥–µ–Ω–∏—è' : 
          '–ù–µ—Ç –≤–≤–µ–¥–µ–Ω–∏—è';
        contentEl.textContent = `–í–≤–µ–¥–µ–Ω–∏–µ: ${intro.substring(0, 200)}...`;
        contentEl.style.display = 'block';

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
        const foundKeywords = lesson.keywords.filter(kw => text.includes(kw.toLowerCase()));
        const foundAvoid = lesson.avoid.filter(kw => text.includes(kw.toLowerCase()));

        let status = 'success';
        let message = '‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç';

        if (foundAvoid.length > 0) {
          status = 'error';
          message = `‚ùå –ù–∞–π–¥–µ–Ω—ã –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞: ${foundAvoid.join(', ')}`;
          results.error++;
          
          keywordEl.className = 'keyword-check keyword-found';
          keywordEl.textContent = `‚ö†Ô∏è –ù–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞: ${foundAvoid.join(', ')}`;
          keywordEl.style.display = 'block';
        } else if (foundKeywords.length === 0) {
          status = 'warning';
          message = `‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω—ã –æ–∂–∏–¥–∞–µ–º—ã–µ —Å–ª–æ–≤–∞: ${lesson.keywords.join(', ')}`;
          results.warning++;
          
          keywordEl.className = 'keyword-check keyword-found';
          keywordEl.textContent = `‚ö†Ô∏è –û–∂–∏–¥–∞–µ–º—ã–µ —Å–ª–æ–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`;
          keywordEl.style.display = 'block';
        } else {
          results.success++;
          
          keywordEl.className = 'keyword-check keyword-ok';
          keywordEl.textContent = `‚úÖ –ù–∞–π–¥–µ–Ω—ã: ${foundKeywords.join(', ')}`;
          keywordEl.style.display = 'block';
        }

        statusEl.className = `lesson-status ${status}`;
        statusEl.textContent = message;

      } catch (error) {
        statusEl.className = 'lesson-status error';
        statusEl.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
        results.error++;
      }
    }

    async function runTests() {
      // –¢–µ—Å—Ç–∏—Ä—É–µ–º —É—Ä–æ–∫–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
      for (const lesson of lessons) {
        await testLesson(lesson);
        await new Promise(r => setTimeout(r, 500));
      }

      // –ü–æ–∫–∞–∑–∞—Ç—å –∏—Ç–æ–≥–∏
      document.getElementById('stat-total').textContent = results.total;
      document.getElementById('stat-success').textContent = results.success;
      document.getElementById('stat-warning').textContent = results.warning;
      document.getElementById('stat-error').textContent = results.error;
      document.getElementById('summary').style.display = 'block';
      
      console.log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ:', results);
    }

    // –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
    runTests();
  </script>
</body>
</html>
